<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>TRASLADO DE FONDOS ENTRE TARJETAS</title>
<link rel="stylesheet" href="css/styles.css"/>
<link rel="stylesheet" href="css/styles.css"/>
<link href="css/style.css" rel="stylesheet"/>
<link href="css/menu.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery-1.10.2.js"></script>
<script type="text/javascript" src="js/style.js"></script>  
<script type="text/javascript" src="js/ConexionWebService.js"></script>
<script type="text/javascript" src="js/ValidacionUsuario.js"></script>
<link rel="stylesheet" media="screen" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.min.css">
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/alertify.js"></script>
<script type="text/javascript" src="js/ValidacionNumerica.js"></script>
<link rel="stylesheet" href="css/alertify.core.css" />
<link rel="stylesheet" href="css/alertify.default.css" />
<link rel="stylesheet" href="css/bootstrap.min.css" />
<script src="js/script.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/photobooth.js"></script>
<style>
          input, select{
        border-radius:8px;
        
        }
  h3 {
        text-shadow: 0px 2px 3px #555;
        }
        </style>
</head>

<body id="bodyBase">
<h5 style="color:#CCC;margin-left:10px; margin-top:5px">Modulo Recargue en Línea</h5>
<h4 align="right" style="color:#FFF;margin-left:10px; margin-top:5px; margin-right: 10px">Bienvenido(a): <label id="usuarioSesion" style="color:#FFF"></label></h4>
<h3 align="right" style="margin-top:2%; margin-right:2%; color:#09C">Recargue en Línea</h3>
  <div id='cssmenu'>
            <ul>
               <li class='' style="display:none" id="AdminCredenciales" class="desactive"><a href='#' title="Admin.Credenciales">ADMINISTRACIÓN DE CREDENCIALES</a>
                  <ul style="margin-right:-42%">
                     <li id="ReemplazoCredencial" style="display:none"><a href='ReemplazarCredencial.html' title="Reemplazo de credenciales">Reemplazo de credenciales</a></li>
                     <li class='last'><a href='AdminCredencial.html' title="Cambio de Estado">CAMBIO DE ESTADO</a></li>
                     <li class='last'><a href='ConsultaMovimientosAcudiente.html' title="Consulta de Movimientos">CONSULTA DE MOVIMIENTOS</a></li>
                     <li class='last'><a href='ConsultaSaldo.html' title="Consulta de Saldos">CONSULTA DE SALDOS</a></li>
                     <li class='last'><a href='ServicioProximoRecargaLinea.php' title="Recarga en Linea">RECARGA EN LINEA</a></li>
                     <li class='last'><a href='TrasladoCredencialAcudiente.html' title="Traslado de Fondos entre Credenciales">TRASLADO DE FONDOS ENTRE CREDENCIALES</a></li>
                  </ul>
               </li>
               
               <li class="" id="RutaEscolar" style="display:none" class="desactive"><a href='#' title="Ruta Escolar">RUTA ESCOLAR</a>
                    <ul style="margin-right:-42%">
                        <li><a href='EnvioMensajesMonitor.html' title="Envío de Mensajes">ENVÍO DE MENSAJES</a></li>
                        <li class='last' title="Tracking"><a href="javascript:void(0);" onclick="enviar_variables();">TRACKING</a></li>
                        <li><a href='#' title="Información de la Ruta">INFORMACIÓN DE LA RUTA</a></li>
                    </ul>
               </li>
               <li class="" id="RestriccionConsumo" style="display:none" class="desactive"><a href='#' title="Restricci&oacute;n de Consumo">RESTRICCI&Oacute;N DE CONSUMO</a>
                    <ul style="margin-right:-42%">
                      <li><a href='RestriccionConsumoValor.html' title="Restricciones por Valor">RESTRICCIONES POR VALOR</a></li>
                      <li><a href='RestriccionConsumoProducto.html' title="Restricciones por Producto">RESTRICCIONES POR PRODUCTO</a></li>
                  </ul>
               </li>
                <li class="" id="RestauranteAcudientes" style="display:none" class="desactive">
                  <a href='#' title="Restaurante">RESTAURANTE</a>
                  <ul style="margin-right:-42%">
                    <li>
                      <a href='MenuSemanal.html' title="Menú Semanal"> 
                        MENÚ SEMANAL
                      </a>
                    </li>
                  </ul>
                </li>              
               
                <li class="" id="Modificacion Datos Perfil" style="display:none" class="desactive"><a href='ModificarAcudiente.html' title="Modificacion Datos Perfil">Modificacion Datos Perfil</a>
                    <ul style="margin-right:-42%">    
                    </ul>
                 </li>
               <li class="" id="Salir"><a href='#' title="Cerrar Sesi&oacute;n">CERRAR SESI&Oacute;N</a>
                    <ul style="margin-right:-42%">
                        
                    </ul>
               </li>
            </ul>

          

        </div>
<div class="contenidoBorde">
  
  <div class="container-fluid">
    <!-- ORIGEN -->
    <h3 align="center">Origen</h3>
    <div class="row">
      <div class="col-md-9" style="padding-top: 5px">
        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="selectIdCredencial"><font color="#09C" size="2">Id de Usuario:</font></label>
          </div>
          <div class="col-md-9">
            <select id="selectIdCredencial" name="selectIdCredencial" class="form-control"></select>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtPrimerApellido"><font color="#09C" size="2">Primer Apellido:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtPrimerApellido" id="txtPrimerApellido" disabled class="form-control"/>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtSegundoApellido"><font color="#09C" size="2">Segundo Apellido:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtSegundoApellido" id="txtSegundoApellido" disabled class="form-control"/>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtPrimerNombre"><font color="#09C" size="2">Primer Nombre:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtPrimerNombre" id="txtPrimerNombre" disabled class="form-control"/>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtSegundoNombre"><font color="#09C" size="2">Segundo Nombre:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtSegundoNombre" id="txtSegundoNombre" disabled class="form-control"/>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtRecarga"><font color="#09C" size="2">Saldo:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtRecarga" id="txtRecarga" disabled class="form-control"/>
          </div>
        </div><br/>
      </div>
      <div class="col-md-2">
        <img src="" id="imageFoto" name="imageFoto" width="100%"/>
      </div>
    </div>

    <!-- DESTINO -->
    <h3 align="center">Destino</h3>
    <div class="row">
      <div class="col-md-9" style="padding-top: 5px">
        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="selectUsuario"><font color="#09C" size="2">Id de Usuario:</font></label>
          </div>
          <div class="col-md-9">
            <select id="selectUsuario" name="selectUsuario" class="form-control"></select>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtPrimerApellidoDestino"><font color="#09C" size="2">Primer Apellido:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtPrimerApellidoDestino" id="txtPrimerApellidoDestino" disabled class="form-control"/>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtSegundoApellidoDestino"><font color="#09C" size="2">Segundo Apellido:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtSegundoApellidoDestino" id="txtSegundoApellidoDestino" disabled class="form-control"/>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtPrimerNombreDestino"><font color="#09C" size="2">Primer Nombre:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtPrimerNombreDestino" id="txtPrimerNombreDestino" disabled class="form-control"/>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtSegundoNombreDestino"><font color="#09C" size="2">Segundo Nombre:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtSegundoNombreDestino" id="txtSegundoNombreDestino" disabled class="form-control"/>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtRecargaDestino"><font color="#09C" size="2">Saldo:</font></label>
          </div>
          <div class="col-md-9">
            <input type="text" name="txtRecargaDestino" id="txtRecargaDestino" disabled class="form-control"/>
          </div>
        </div><br/>

        <div class="row">
          <div class="col-md-3" style="padding-top: 5px">
            <label for="txtValorRecargaDestino"><font color="#09C" size="2">Valor de recargue:</font></label>            
          </div>
          <div class="col-md-9">
            <input type="text" name="txtValorRecargaDestino" id="txtValorRecargaDestino" onKeyUp="format(this)" class="form-control"/>
          </div>
        </div><br/>

      </div>
      <div class="col-md-2">
        <img src="" id="imageFotoDestino" name="imageFotoDestino" width="100%"/>
      </div>
    </div>

    <div class="row">
      <div class="col-md-9" style="padding-top: 5px" align="right">
        <button type="button" id="btnRecargue" name="btnRecargue" class="btn btn-primary" style="display:none">Realizar Recargue</button>
      </div>
    </div><br/><br/>
  </div>
</div>
<script type="text/javascript">
  //Capturar evento del boton crear
    $("#btnRecargue").click(function(e) {
      //Se obtienen los datos a enviar    
      var usuarioOrigen = $("#selectIdCredencial").val();
      var usuarioDestino = $("#selectUsuario").val();
      var saldo = $("#txtValorRecargaDestino").val();
      saldo = saldo.replace('.','');
      var saldoOrigen = $("#txtRecarga").val();
      var saldoDestino = $("#txtRecargaDestino").val();
      var usuarioSesion = localStorage.getItem("usuario"); 
      /*
        Descripcion: Obtener fecha y hora para registrar movimientos
      */
      var date = new Date();
      var dia = date.getDate();
      var mes = (date.getMonth() + 1);
      var year = date.getFullYear();
      
      
      if(dia < 10) {
        dia = '0' + dia;
      } 
      
      if(mes < 10) {
        mes = '0' + mes;
      } 
      
      var fechaActual = year + "-" + mes + "-" + dia;
      var horaActual = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds(); 
      
      if(saldo != ""){
        if(parseInt(saldo) > 0){
          if(parseInt(saldoOrigen) >= parseInt(saldo)){
            //Se guardan los datos en un JSON
            var usuario = {
              usuarioOrigen: usuarioOrigen,
              usuarioDestino: usuarioDestino,
              usuarioSesion: usuarioSesion,
              saldo: saldo,
              fecha: fechaActual,
              hora: horaActual
            }   
            
            $("#btnRecargue").attr("disabled","disabled")
            $.post("ActionTrasladoFondos.php", usuario)
            .done(function( data ) {
              var json = JSON.parse(data);
              if($.trim(json.estado) == "ok"){
                alert(json.mensaje);
                window.location.href = "TrasladoCredencialAcudiente.html";
              }else{
                alert(mensaje);
              }
              
            })
            

          }else{
            alert("El saldo de origen debe ser mayor o igual al saldo a transferir")
          }
        }else{
          alert("El saldo a transferir debe ser mayor a cero")
        }
        
      }else{
        alert("Debe ingresar el saldo a transferir")
      }
      
      
    });
  $("#Salir").click(function(e) {
    var confirmar = window.confirm("¿Desea cerrar sesión?");
    if(confirmar){
      localStorage.removeItem("usuario");
      localStorage.removeItem("tipoUsuario");
      localStorage.removeItem("primernombreusuario");
      localStorage.removeItem("segundonombreusuario");
      localStorage.removeItem("primerapellidousuario");
      localStorage.removeItem("segundoapellidousuario");
      window.location.href = "index.html";
    }
  });

  function enviar_variables(){
    var usuarioSesion = localStorage.getItem("usuario");
    location.href="TrackingPadres.php?proced="+ usuarioSesion;
  } 
  window.addEventListener('load',init);
  function init(){
    var usuarioSesion = localStorage.getItem("primernombreusuario") + " " + localStorage.getItem("segundonombreusuario") + " " + localStorage.getItem("primerapellidousuario") + " " + localStorage.getItem("segundoapellidousuario"); 
    
    $("#usuarioSesion").html(usuarioSesion);
    var usuarioSesion = localStorage.getItem("usuario");
    $.post("ActionListarCredencialesAcudiente.php", {acudiente: usuarioSesion})
    .done(function( data ) {
      
      $("#selectIdCredencial").html("")
      if($.trim(data) != "[]"){
        $("#selectIdCredencial").append('<option value="SELECCIONE">Seleccione...</option>');
        
        var json = JSON.parse(data);
        $.each(json, function(i, item) {
          $("#selectIdCredencial").append('<option value="' + json[i].usuario + '">' + json[i].primerNombre + ' ' + json[i].segundoNombre + ' ' + json[i].primerApellido + ' ' + json[i].segundoApellido + '</option>');
        });
      }
    }); 
    
  }

  $("#selectIdCredencial").change (function(e) {
      
      if($("#selectIdCredencial").val() != "Seleccione"){
        var usuarioSesion = localStorage.getItem("usuario"); 
        var usuarioConsultar = $("#selectIdCredencial").val();
        
        $.post("ActionConsultarUsuarioPorIdAcudiente.php", {usuario: usuarioConsultar, acudiente: usuarioSesion})
        .done(function( data ) {
          var jsonUsuario = JSON.parse(data);
      
          if(jsonUsuario.length > 0){
            $.each(jsonUsuario, function(i, item) {
              $("#txtPrimerApellido").val(jsonUsuario[i].primerApellido);
              $("#txtSegundoApellido").val(jsonUsuario[i].segundoApellido);
              $("#txtPrimerNombre").val(jsonUsuario[i].primerNombre);
              $("#txtSegundoNombre").val(jsonUsuario[i].segundoNombre);
              $("#txtRecarga").val(jsonUsuario[i].SaldoCredencial);              
              $('#imageFoto').attr('src',jsonUsuario[i].ImagenFotografica);          
              $("#selectUsuario").html("")

              $("#txtPrimerApellidoDestino").val("");
              $("#txtSegundoApellidoDestino").val("");
              $("#txtPrimerNombreDestino").val("");
              $("#txtSegundoNombreDestino").val("");
              $("#txtRecargaDestino").val("");
              $('#imageFotoDestino').attr('src',""); 
              $.post("ActionListarCredencialesAcudiente.php", {acudiente: usuarioSesion})
              .done(function( data ) {
                
                if($.trim(data) != "[]"){
                  $("#selectUsuario").append('<option value="SELECCIONE">Seleccione...</option>');                  
                  var json = JSON.parse(data);
                  if(json.length > 1){
                    $.each(json, function(i, item) {
                      if($("#selectIdCredencial").val() != json[i].usuario){
                        $("#selectUsuario").append('<option value="' + json[i].usuario + '">' + json[i].primerNombre + ' ' + json[i].segundoNombre + ' ' + json[i].primerApellido + ' ' + json[i].segundoApellido + '</option>');
                      }
                      
                    });
                    
                  }else{
                    alert("La cantidad de estudiantes asociados no es suficiente para realizar un traslado de saldo")
                    $("#btnRecargue").css({"display":"none"})
                  }
                  
                }
                
              }); 
            });
          }else{
            $("#txtPrimerApellido").val("");
            $("#txtSegundoApellido").val("");
            $("#txtPrimerNombre").val("");
            $("#txtSegundoNombre").val("");
            $("#txtDireccion").val("");
            $("#txtTelefono1").val("");
            $("#txtTelefono2").val("");
            $("#txtClave").val("");
            $("#txtAcudiente").val("");
            $("#txtTipoUsuario").val("");
            $("#txtRecarga").val("");
            $("#btnRecargue").css({"display":"none"})

            $("#txtPrimerApellidoDestino").val("");
            $("#txtSegundoApellidoDestino").val("");
            $("#txtPrimerNombreDestino").val("");
            $("#txtSegundoNombreDestino").val("");
            $("#txtRecargaDestino").val("");
            $('#imageFotoDestino').attr('src',"");          
            $("#btnRecargue").css({"display":"none"})
            $("#selectUsuario").html("")
          }
        });
      }else{
        $("#selectUsuario").html("")
        $("#txtPrimerApellido").val("");
        $("#txtSegundoApellido").val("");
        $("#txtPrimerNombre").val("");
        $("#txtSegundoNombre").val("");
        $("#txtDireccion").val("");
        $("#txtTelefono1").val("");
        $("#txtTelefono2").val("");
        $("#txtClave").val("");
        $("#txtAcudiente").val("");
        $("#txtTipoUsuario").val("");
        $("#txtRecarga").val("");
        $("#btnRecargue").css({"display":"none"})

        $("#txtPrimerApellidoDestino").val("");
        $("#txtSegundoApellidoDestino").val("");
        $("#txtPrimerNombreDestino").val("");
        $("#txtSegundoNombreDestino").val("");
        $("#txtRecargaDestino").val("");
        $('#imageFotoDestino').attr('src',""); 
      }
    });

  $("#selectUsuario").change (function(e) {
      
      if($("#selectUsuario").val() != "Seleccione"){
        var usuarioSesion = localStorage.getItem("usuario"); 
        var usuarioConsultar = $("#selectUsuario").val();
        
        $.post("ActionConsultarUsuarioPorIdAcudiente.php", {usuario: usuarioConsultar, acudiente: usuarioSesion})
        .done(function( data ) {console.log(data)
          var jsonUsuario = JSON.parse(data);
      
          if(jsonUsuario.length > 0){
            $.each(jsonUsuario, function(i, item) {
              $("#txtPrimerApellidoDestino").val(jsonUsuario[i].primerApellido);
              $("#txtSegundoApellidoDestino").val(jsonUsuario[i].segundoApellido);
              $("#txtPrimerNombreDestino").val(jsonUsuario[i].primerNombre);
              $("#txtSegundoNombreDestino").val(jsonUsuario[i].segundoNombre);
              $("#txtRecargaDestino").val(jsonUsuario[i].SaldoCredencial);              
              $('#imageFotoDestino').attr('src',jsonUsuario[i].ImagenFotografica);          
              $("#btnRecargue").css({"display":"block"})
            });
          }else{
            $("#txtPrimerApellidoDestino").val("");
            $("#txtSegundoApellidoDestino").val("");
            $("#txtPrimerNombreDestino").val("");
            $("#txtSegundoNombreDestino").val("");
            $("#txtRecargaDestinoa").val("");
            $('#imageFotoDestino').attr('src',"");          
            $("#btnRecargue").css({"display":"none"})
            $("#selectUsuario").html("")
          }
        });
      }
    });
</script>
<script src="js/jquery.js"></script>
<script src="js/jquery.validate.js"></script>
<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
</body>
</html>

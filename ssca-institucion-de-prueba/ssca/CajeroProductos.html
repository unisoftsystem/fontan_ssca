
<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>SSCA</title>
        <link href="css/style.css" rel="stylesheet"/>
        <link href="css/menu.css" rel="stylesheet"/>
        <link href="css/popup.css" rel="stylesheet"/>
		<link rel="stylesheet" type="text/css" href="dist/tablefilter/style/tablefilter.css">
        <script type="text/javascript" src="js/jquery-1.10.2.js"></script>
        <script type="text/javascript" src="js/style.js"></script>  
        <script type="text/javascript" src="js/ConexionWebService.js"></script>
		<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.0/css/bootstrap-toggle.min.css" rel="stylesheet">
		<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.0/js/bootstrap-toggle.min.js"></script>
        <link rel="stylesheet" media="screen" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.min.css">
        <script type="text/javascript" src="js/alertify.js"></script>
        <link rel="stylesheet" href="css/alertify.core.css" />
        <link rel="stylesheet" href="css/alertify.default.css" />
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <script src="js/script.js"></script>
        <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
        <script type="text/javascript" src="js/popup.js"></script>
        <style type="text/css">
			@import url("http://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,400italic");
			@import url("//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css");
				body {
				padding: 60px 0px;
				background-color: rgb(220, 220, 220);
			}

			.event-list {
				list-style: none;
				font-family: 'Lato', sans-serif;
				margin: 0px;
				padding: 0px;
			}
			.event-list > li {
				background-color: rgb(255, 255, 255);
				box-shadow: 0px 0px 5px rgb(51, 51, 51);
				box-shadow: 0px 0px 5px rgba(51, 51, 51, 0.7);
				padding: 0px;
				margin: 0px 0px 20px;
			}
			.event-list > li > time {
				display: inline-block;
				width: 100%;
				color: rgb(255, 255, 255);
				background-color: rgb(68, 59, 199);
				padding: 5px;
				text-align: center;
				text-transform: uppercase;
			}
			.event-list > li:nth-child(even) > time {
				background-color: rgb(165, 82, 167);
			}
			.event-list > li > time > span {
				display: none;
			}
			.event-list > li > time > .day {
				display: block;
				font-size: 56pt;
				font-weight: 100;
				line-height: 1;
			}
			.event-list > li time > .month {
				display: block;
				font-size: 24pt;
				font-weight: 900;
				line-height: 1;
			}
			.event-list > li > img {
				width: 100%;
			}
			.event-list > li > .info {
				padding-top: 5px;
				text-align: center;
			}
			.event-list > li > .info > .title {
				font-size: 17pt;
				font-weight: 700;
				margin: 0px;
			}
			.event-list > li > .info > .desc {
				font-size: 13pt;
				font-weight: 300;
				margin: 0px;
			}
			.event-list > li > .info > ul,
			.event-list > li > .social > ul {
				display: table;
				list-style: none;
				margin: 10px 0px 0px;
				padding: 0px;
				width: 100%;
				text-align: center;
			}
			.event-list > li > .social > ul {
				margin: 0px;
			}
			.event-list > li > .info > ul > li,
			.event-list > li > .social > ul > li {
				display: table-cell;
				cursor: pointer;
				color: rgb(30, 30, 30);
				font-size: 11pt;
				font-weight: 300;
				padding: 3px 0px;
			}
			.event-list > li > .info > ul > li > a {
				display: block;
				width: 100%;
				color: rgb(30, 30, 30);
				text-decoration: none;
			} 
			.event-list > li > .social > ul > li {    
				padding: 0px;
			}
			.event-list > li > .social > ul > li > a {
				padding: 3px 0px;
			} 
			.event-list > li > .info > ul > li:hover,
			.event-list > li > .social > ul > li:hover {
				color: rgb(30, 30, 30);
				background-color: rgb(200, 200, 200);
			}
			.facebook a,
			.twitter a,
			.google-plus a {
				display: block;
				width: 100%;
				color: rgb(75, 110, 168) !important;
			}
			.twitter a {
				color: rgb(79, 213, 248) !important;
			}
			.google-plus a {
				color: rgb(221, 75, 57) !important;
			}
			.facebook:hover a {
				color: rgb(255, 255, 255) !important;
				background-color: rgb(75, 110, 168) !important;
			}
			.twitter:hover a {
				color: rgb(255, 255, 255) !important;
				background-color: rgb(79, 213, 248) !important;
			}
			.google-plus:hover a {
				color: rgb(255, 255, 255) !important;
				background-color: rgb(221, 75, 57) !important;
			}

			@media (min-width: 768px) {
				.event-list > li {
					position: relative;
					display: block;
					width: 100%;
					height: 120px;
					padding: 0px;
				}
				.event-list > li > time,
				.event-list > li > img  {
					display: inline-block;
				}
				.event-list > li > time,
				.event-list > li > img {
					width: 120px;
					float: left;
				}
				.event-list > li > .info {
					background-color: rgb(245, 245, 245);
					overflow: hidden;
				}
				.event-list > li > time,
				.event-list > li > img {
					width: 120px;
					height: 120px;
					padding: 0px;
					margin: 0px;
				}
				.event-list > li > .info {
					position: relative;
					height: 120px;
					text-align: left;
					padding-right: 40px;
				} 
				.event-list > li > .info > .title, 
				.event-list > li > .info > .desc {
					padding: 0px 10px;
				}
				.event-list > li > .info > ul {
					position: absolute;
					left: 0px;
					bottom: 0px;
				}
				.event-list > li > .social {
					position: absolute;
					top: 0px;
					right: 0px;
					display: block;
					width: 40px;
				}
				.event-list > li > .social > ul {
					border-left: 1px solid rgb(230, 230, 230);
				}
				.event-list > li > .social > ul > li {      
					display: block;
					padding: 0px;
				}
				.event-list > li > .social > ul > li > a {
					display: block;
					width: 40px;
					padding: 10px 0px 9px;
				}
			}
			.list-group.panel > .list-group-item {
				border-bottom-right-radius: 4px;
				border-bottom-left-radius: 4px
			}
			.list-group-submenu {
				margin-left:20px;
			}
        </style>
    </head>
    <body id="bodyBase">
		
			<div style="margin-top: -25px">
				<table cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td width="20px">&nbsp;</td>
						<td><label for="txtPrimerApellido"><font color="#00C">Primer Apellido</font></label></td>
						<td width="10px">&nbsp;</td>
						<td><input type="text" disabled id="txtPrimerApellido" name="txtPrimerApellido"/></td>
						<td width="10px">&nbsp;</td>
						<td><label for="txtSegundoApellido"><font color="#00C">Segundo Apellido</font></label></td>
						<td width="10px">&nbsp;</td>						
						<td><input type="text" disabled id="txtSegundoApellido" name="txtSegundoApellido"/></td>
						<td rowspan="2" valign="top"><img src="" width="70px" style="margin-top: 10px" id="fotoUsuario"/></td>
						<td colspan="4"><h2 align="right" style="margin-top:2%; margin-right:2%; color:#00C">Pedidos de Cafeter&iacute;a & Restaurante</h2></td>
					</tr>
					<tr>
						<td width="20px">&nbsp;</td>
						<td valign="top">
							<label for="txtPrimerNombre"><font color="#00C">Primer Nombre</font></label><br><br>
							<label for="txtFecha" id="lblFecha" style="display: none"><font color="#00C">Fecha: </font></label>
						</td>
						<td width="10px">&nbsp;</td>
						<td valign="top">
							<input type="text" disabled id="txtPrimerNombre" name="txtPrimerNombre"/><br><br>
							<input id="txtFecha" name="txtFecha" class="form-control" type="date" style="display: none"/>
						</td>
						<td width="10px">&nbsp;</td>
						<td valign="top">
							<label for="txtSegundoNombre"><font color="#00C">Segundo Nombre</font></label><br><br>
							<label for="txtHora" id="lblHora" style="display: none"><font color="#00C">Hora: </font></label>
						</td>
						<td width="10px">&nbsp;</td>
						<td valign="top">
							<input type="text" disabled id="txtSegundoNombre" name="txtSegundoNombre"/><br><br>
							<input id="txtHora" name="txtHora" class="form-control" type="time" style="display: none"/>
						</td>
						<td width="10px">&nbsp;</td>	
						<td>
							<label for="txtSaldoCredencial"><font color="#00C">Saldo de Credencial</font></label><br>
							<label class="checkbox-inline">
								<input id="toggle-event" type="checkbox" checked  data-toggle="toggle" data-on="Si" data-off="No"><b>Entrega Inmediata</b>
							</label><br>
							<h4 id="txtTotal"></h4>	
						</td>
						<td width="10px">&nbsp;</td>
						<td valign="top">
							<input type="text" disabled id="txtSaldoCredencial" name="txtSaldoCredencial"/>&nbsp;&nbsp;&nbsp;
							<button id="btnPagar" name="btnPagar" class="btn btn-primary" style="visibility: hidden">Pagar</button><br>
							<input type="radio" name="tipo" id="conAlistamiento" value="CONALISTAMIENTO" />
							<label for="conAlistamiento" style="margin-left: 10px;" id="lblconAlistamiento">Con Alistamiento</label><br>
							<input type="radio" name="tipo" id="sinlistamiento" value="SINALISTAMIENTO" checked="checked"/>
							<label for="sinlistamiento" style="margin-left: 10px;" id="lblsinlistamiento">Sin Alistamiento</label>							
						</td>
					</tr>
				</table>
				
			</div>
			<div id='cssmenu' style="width: 25px;margin-top: -25px; margin-top: -20px">
			
			</div>
			
			<div class="contenidoBorde" style="width: 30%; float: left; overflow: auto; padding:0; margin-top: -20px" id="Categorias">
				
				<!--<div class="[ col-xs-12 col-sm-offset-2 col-sm-8 ]" style="margin-left: 0; width: 100%">
				
					<ul class="event-list">
						<li id="item1" style="cursor: pointer">
							<img src='images/56e2cd2363542.png' >  
														
							<div class="info" >
								<h2 class="title">Categoria 1</h2>
								<p class="desc">Categoria</p>								
												
							</div>
							
						</li>
						
						<div class="collapse" id="demo4" style="height: 40%; margin-top:-17px; margin-bottom: 10px">
							<a href="#" class="list-group-item">Subitem 1</a>
							<a href="#" class="list-group-item">Subitem 2</a>
							<a href="#" class="list-group-item">Subitem 3</a>
						</div>
						
					</ul>
					
				</div>	-->
			  
			</div>
			
			<div class="contenidoBorde" style="width: 30%; float: left; overflow: auto; margin-top: -20px" id="Productos" align="center">
				
				
			</div>
			
			<div class="contenidoBorde" style="width: 37%; float: left; overflow: auto; margin-top: -20px">	
				<table width="100%" id="demo">
					<thead>
						<tr align="center">
							<th>Nombre</th>
							<th>Precio</th>
							<th>Cantidad</th>
							<th>Total</th>
							<th>Borrar</th>
						</tr>
					</thead>
					<tbody id="tbody">
						
					</tbody>
			   </table>
			</div>
			
			<!--<div class="contenidoBorde" style="width: 90%; float: left;">
				
				
			</div>-->
			
			<div style="height: 50px">&nbsp;</div>
		<script src="dist/tablefilter/tablefilter.js"></script>
		<script>
        
			//Configuracion de la tabla    
			var filtersConfig = {
				base_path: 'dist/tablefilter/',
				auto_filter: true,//Aceptar o no filtro automatico cuando se empieza a escribir
				auto_filter_delay: 1100, //milliseconds
				filters_row_index: 1,
				remember_page_number: false,
				remember_page_length: false,
				alternate_rows: false,
				grid_layout: true,
				grid_width: '100%',//Ancho de la tabla
				alternate_rows: true,
				btn_reset: false,//Activar el boton de resetear los campos de filtro
				rows_counter: false,
				loader: true,
				status_bar: false,
				col_0: 'none',//Configurar el filtro de la columna con select
				col_1: 'none',//Configurar el filtro de la columna con select
				col_2: 'none',//Configurar el filtro de la columna con select
				col_3: 'none',//Configurar el filtro de la columna con select
				col_4: 'none',//Configurar el filtro de la columna con select
				extensions:[
					{
						name: 'advancedGrid',
						// For the purpose of this demo, ezEditTable dependency
						// is loaded from its own website which is not a CDN.
						// This dependency also requires a licence therefore
						// DO NOT import it in this way in your projects.
						filename: 'ezEditTable_min.js',
						vendor_path: 'http://190.60.211.17/ssca/js/',
						// Once ezEditTable dependency is installed in your
						// project import it by pointing to a local path:
						// vendor_path: 'path/to/ezEditTable'
						editable: false,
						selection: true,
						default_selection: 'both',
						editor_model: 'cell',
						cell_editors: [
							{ type: 'none', attributes:[['title', 'Nombre']]},
							{ type: 'none', attributes:[['title', 'Precio Unitario']]},
							{ type: 'none', attributes:[['title', 'Cantidad Solicitada']]},
							{ type: 'none', attributes:[['title', 'Total']]}
						]
					}, {
						name: 'sort',
						types: [
							'string', 'number', 'number',
							'number'
						]
					}
				]
			};
			var tf = new TableFilter('demo', filtersConfig);
			tf.init();
			
        </script>
		<script>
        	window.addEventListener('load',init);
			var numeroVeces = 0;
			$('#toggle-event').change(function() {
				if($(this).prop('checked') == true){
					$("#txtHora").css({"display":"none"});
					$("#lblHora").css({"display":"none"});
					$("#txtFecha").css({"display":"none"});
					$("#lblFecha").css({"display":"none"});
					$("#conAlistamiento").css({"visibility":"visible"});
					$("#sinlistamiento").css({"visibility":"visible"});
					$("#lblconAlistamiento").css({"visibility":"visible"});
					$("#lblsinlistamiento").css({"visibility":"visible"});
				}else{
					$("#txtHora").css({"display":"block"});
					$("#lblHora").css({"display":"block"});
					$("#txtFecha").css({"display":"block"});
					$("#lblFecha").css({"display":"block"});
					$("#conAlistamiento").css({"visibility":"hidden"});
					$("#sinlistamiento").css({"visibility":"hidden"});
					$("#lblconAlistamiento").css({"visibility":"hidden"});
					$("#lblsinlistamiento").css({"visibility":"hidden"});
				}
				
			})
			
			function init(){	
				var usuarioSesion = localStorage.getItem("idUsuarioApp");
				if(usuarioSesion == null){
					window.location.href = "Cajero.html";
				}else{
					var PrimerNombreUsuarioSesionApp = localStorage.getItem("PrimerNombreUsuarioSesionApp");
					var SegundoNombreUsuarioSesionApp = localStorage.getItem("SegundoNombreUsuarioSesionApp");
					var PrimerApellidoUsuarioSesionApp = localStorage.getItem("PrimerApellidoUsuarioSesionApp");
					var SegundoApellidoUsuarioSesionApp = localStorage.getItem("SegundoApellidoUsuarioSesionApp"); 
					var SaldoCredencial = localStorage.getItem("SaldoCredencial");
					var ImagenFotograficaUsuarioSesionApp = localStorage.getItem("ImagenFotograficaUsuarioSesionApp");
					console.log(ImagenFotograficaUsuarioSesionApp);
					
					saldoActual = parseInt(SaldoCredencial);
					console.log(saldoActual);
					$("#usuarioSesion").html(usuarioSesion);
					$("#txtSaldoCredencial").val(SaldoCredencial);
					$("#txtPrimerNombre").val(PrimerNombreUsuarioSesionApp);
					$("#txtSegundoNombre").val(SegundoNombreUsuarioSesionApp);
					$("#txtPrimerApellido").val(PrimerApellidoUsuarioSesionApp);
					$("#txtSegundoApellido").val(SegundoApellidoUsuarioSesionApp);
					$("#fotoUsuario").attr("src", ImagenFotograficaUsuarioSesionApp);
					saldoActual = parseInt($("#txtSaldoCredencial").val())
				}
				$.post("ActionListarCategorias.php", {})
				.done(function( data ) {
					console.log($.trim(data));
					
					if($.trim(data) != "[]"){
						var foto = "";
						var json = JSON.parse(data);
						
						var html = '';
						$("#Categorias").html("");
						$.each(json, function(i, item) {
						var open_panel_count = 0;
							if(json[i].Imagen.length != 0){
								foto = json[i].Imagen;
							}else{
								foto = "images/box.png";
							}
							$("#Categorias").append('<div class="[ col-xs-12 col-sm-offset-2 col-sm-8 ]" style="margin-left: 0; width: 100%">' +				
							'<ul class="event-list">' +
								'<li id="item' + i + '" style="cursor: pointer" categoria="' + json[i].codigo + '">' +
									'<img src="' + foto + '" >  ' +
																
									'<div class="info" >' +
										'<h2 class="title">' + json[i].Nombre + '</h2>' +
										'<p class="desc"></p>' +														
									'</div>' +
								'</li>' +								
								'<div class="collapse" id="demo' + i + '" style="height: 40%; margin-top:-17px; margin-bottom: 10px">' +
									
								'</div>' +
								
							'</ul>' +
							
							'</div>');
							
			
							$('#item' + i).click(function() {
								$('.collapse').collapse('hide');
								$('#demo' + i).collapse(open_panel_count ? 'hide' : 'show');
							});

							$('#demo' + i).on('shown.bs.collapse', function () {
								var idCategoria = $("#item" + i).attr("categoria");
								ListarSubCategorias(idCategoria, i)
								open_panel_count++;
							});

							$('#demo' + i).on('hidden.bs.collapse', function () {
								open_panel_count--;				
							}); 
						});
						
					}
				});
			}
			
			function ListarSubCategorias(categoria, index){
				$.post("ActionListarSubCategorias.php", {idCategoria: categoria})
				.done(function( data ) {
					console.log($.trim(data));
					
					if($.trim(data) != "[]"){
						$('#demo' + index).html("");
						var json = JSON.parse(data);
						$.each(json, function(i, item) {					
							$('#demo' + index).append('<a href="#" class="list-group-item" id="Categoria' + index + 'subcategoria' + i + '" data-subcategoria="' + json[i].codigo + '">' + json[i].Nombre + '</a>');
							
							
							
							$('#Categoria' + index + 'subcategoria' + i).click(function(e) {
								var id = $(this).attr("data-subcategoria");
								localStorage.setItem("idSucategoriaElegida",id);	
								var idUsuarioApp = localStorage.getItem("idUsuarioApp"); 
								var idCredencialSesion = localStorage.getItem("idCredencialSesion"); 
								//EnviarDatos({subcategoria: id, dia: dia, idUsuario: idUsuarioApp}, "ActionListarProductoSubCategoria.php", "LISTARPRODUCTOSSUB");
								ListarProductos(id, idUsuarioApp, idCredencialSesion);
							});
						});
					}else{
						$('#demo' + index).html("");
						$('#demo' + index).append('<a href="#" class="list-group-item">NO hay Subcategorias</a>');
					}
				});
			}
			
			function ListarProductos(idSucategoria, idUsuarioApp, idCredencialSesion){
				var f = new Date();
				var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
				var dia = f.getDay();
				
				$.post("ActionListarProductoSubCategoria.php", {subcategoria: idSucategoria, dia: dia, idUsuario: idUsuarioApp, idCredencial: idCredencialSesion})
				.done(function( data ) {
					console.log(data);
					
					if($.trim(data) != "[]" && $.trim(data) != "[][]"){
						var html = "";
						var json = JSON.parse(data);
						
						$("#Productos").html("");
						$.each(json, function(i, item) {
							var fotoProducto = "";
							
							if(json[i].Imagen.length != 0){
								fotoProducto = json[i].Imagen;
							}else{
								fotoProducto = "images/box.png";
							}
							if($.trim(json[i].Restriccion) == "NO"){
								var cantiMax = 0;
								var index = Obtener_Index(json[i].codigoProducto);
				
								if(index > -1)	{
									cantiMax = json[i].Stock - jsonCarrito[index].cantidad;
								}else{
									cantiMax = json[i].Stock;
								}	
								html = '<div style="width:40%; border:solid 4px #CCC;display: inline-block; margin-top:5px; background-color:#FFF; padding-top:10px; height: auto;" align="center" class="recuadro" data-fila="' + i + '" data-codigoProducto="' + json[i].codigoProducto + '" data-imagenProducto="' + json[i].Imagen + '" data-descProducto="' + json[i].Descripcion + '">' +
										'<img src="' + fotoProducto + '" width="60%"/><br>' +
										'<font size="-1"><b id="fontNombre' + i + '">' + json[i].NombreProducto + '</b></font><br>' +
										'<font color="#FF0000">$</font><font color="#FF0000" id="fontPrecio' + i + '">' + json[i].ValorUnitario + '</font><br>' +
										'<font size="1"><b>CANTIDADES:</b></font><br>' +
										
										'<div style="display: inline-block;margin:0;">' +
											
										   '<table width="100%" height="10px" cellpadding="0" cellspacing="0" align="center">' +
												'<tr>' +
													'<td align="right" width="20%"><input type="button"  id="btnMenos' + i + '" name="btnMenos' + i + '" style="margin-right:10px" value="-" class="botonMenos btn btn-primary" data-fila="' + i + '"/></td>' +
													'<td align="center" width="30%"><input value="1" style="width:100%; text-align:center;border-radius:4px; border-style:ridge" id="txtCantidad' + i + '" name="txtCantidad' + i + '" type="" value="1"/></td>' +
													'<td width="20%"><input type="button" id="btnMas' + i + '" name="btnMas' + i + '" data-max="' + cantiMax + '" value="+" style="margin-left:10px" class="botonMas btn btn-primary" data-fila="' + i + '"/></td>' +
												'</tr>' +
												'<tr>' +
													'<td colspan="3" align="center"><button type="button" id="btnAgregar' + i + '" name="btnAgregar' + i + '" data-codigoProducto="' + json[i].codigoProducto + '" class="botonAgregar btn btn-primary" data-fila="' + i + '" style="width:90%; margin-top:5px"><font size="-1">Agregar</font></button><br><font color="#FF0000" id="fontError' + i + '">&nbsp;</font></td>' +
												'</tr>' +
											'</table>' +
										'</div>' +
									'</div>';
							}else{
								html = '<div style="width:40%; border:solid 4px #CCC;display: inline-block; margin-top:5px; background-color:#FFF; padding-top:10px; height: auto;" align="center" class="recuadro" data-fila="' + i + '" data-codigoProducto="' + json[i].codigoProducto + '" data-imagenProducto="' + json[i].Imagen + '" data-descProducto="' + json[i].Descripcion + '">' +
								'<img src="' + fotoProducto + '" width="60%"/><br>' +
								'<font size="-1"><b id="fontNombre' + i + '">' + json[i].NombreProducto + '</b></font><br>' +
								'<font color="#FF0000">$</font><font color="#FF0000" id="fontPrecio' + i + '">' + json[i].ValorUnitario + '</font><br>' +
								'<font size="2" color="#FF0000"><b>PRODUCTO RESTRINGIDO POR EL ACUDIENTE</b></font><br>' +
								
								
							'</div>';
							}
							
							$("#Productos").append(html);
							
						});
						
						$(".botonMenos").click(function(e) {
							var fila = $(this).attr("data-fila");
							var cantidadActual = $("#txtCantidad" + fila).val();
							
							var numero = parseInt(cantidadActual);
							if(numero > 1){
								numero -= 1;
								$("#txtCantidad" + fila).val(numero)
								$("#fontError" + fila).html("")
								$("#btnAgregar" + fila).css({display: "block"});
							}
							
						});
						$(".botonMas").click(function(e) {
							
							var fila = $(this).attr("data-fila");
							var cantidadActual = $("#txtCantidad" + fila).val();
							var numero = parseInt(cantidadActual);
							var precio = parseInt($("#fontPrecio" + fila).html());
							var CantidadMaxima = parseInt($(this).attr("data-max"));
							var saldoAux = parseInt($("#txtSaldoCredencial").val()) - (cantidadActual * precio);; 
							var ValorRestriccion = localStorage.getItem("ValorRestriccion"); 
							
							if(ValorRestriccion != ""){
							
								var valor = parseInt(ValorRestriccion);
								var totalActual = Obtener_Total() + (numero * precio);
								if(numero < CantidadMaxima){
									numero += 1;
									var idCredencialSesion = localStorage.getItem("idCredencialSesion"); 
									var date = new Date();
									var dia = date.getDate();
									var mes = (date.getMonth() + 1);
									var year = date.getFullYear();
									
									if(dia < 10) {
										dia = '0' + dia;
									} 
									
									if(mes < 10) {
										mes = '0' + mes;
									} 
									
									var fechaActual = year + "-" + mes + "-" + dia;
									
									$.post("ActionMostrarTotalPorDia.php", {idCredencial: idCredencialSesion, fecha: fechaActual})
									.done(function( data ) {
										if($.trim(data) != "[]"){
											var json = JSON.parse(data);
											console.log(json[0].Total);
											if(json[0].Total != null){
												var totalActual = Obtener_Total() + (numero * precio) + (parseFloat(json[0].Total));
												if(totalActual <= valor){
													if((numero * precio) <= saldoActual){
														$("#btnAgregar" + fila).css({display: "block"});
														$("#txtCantidad" + fila).val(numero)
														console.log(saldoActual + " - " + (numero * precio));
														
														$("#fontError" + fila).html("")
													}else{
														$("#btnAgregar" + fila).css({display: "none"});
														$("#fontError" + fila).html("El saldo actual es de " + saldoAux + ". No es suficiente para agregar mas productos")
													}
												}else{
													$("#btnAgregar" + fila).css({display: "none"});
													$("#fontError" + fila).html("Usted no puede sobrepasar la restriccion de consumir " + ValorRestriccion)
												}
											}else{
												var totalActual = Obtener_Total() + (numero * precio);
												if(totalActual <= valor){
													if((numero * precio) <= saldoActual){
														$("#btnAgregar" + fila).css({display: "block"});
														$("#txtCantidad" + fila).val(numero)
														console.log(saldoActual + " - " + (numero * precio));
														
														$("#fontError" + fila).html("")
													}else{
														$("#btnAgregar" + fila).css({display: "none"});
														$("#fontError" + fila).html("El saldo actual es de " + saldoAux + ". No es suficiente para agregar mas productos")
													}
												}else{
													$("#btnAgregar" + fila).css({display: "none"});
													$("#fontError" + fila).html("Usted no puede sobrepasar la restriccion de consumir " + ValorRestriccion)
												}
											}
										}
									});
								}
							}else{
								console.log(saldoActual);
								if(numero < CantidadMaxima){
									if((numero * precio) <= saldoActual){
										
										$("#btnAgregar" + fila).css({display: "block"});
										$("#txtCantidad" + fila).val(numero + 1)
										console.log(saldoActual + " - " + (numero * precio));
										
										$("#fontError" + fila).html("")
									}else{
										$("#btnAgregar" + fila).css({display: "none"});
										$("#fontError" + fila).html("El saldo actual no es suficiente para agregar mas productos")
									}
									
								}
							}
							
							
						});
						$(".botonAgregar").click(function(e) {
							var fila = $(this).attr("data-fila");
							var cantidadActual = parseInt($("#txtCantidad" + fila).val());
							var precio = parseInt($("#fontPrecio" + fila).html());
							var nombre = $("#fontNombre" + fila).html();
							var CantidadMaxima = parseInt($("#btnMas" + fila).attr("data-max"));
							var codigoProducto = $(this).attr("data-codigoProducto");
							var total = cantidadActual * precio;
							if(parseInt($("#txtSaldoCredencial").val()) >= (cantidadActual * precio)){
								saldoActual = parseInt($("#txtSaldoCredencial").val()) - (cantidadActual * precio);
								console.log(saldoActual);
								ActualizarPedido(codigoProducto, nombre, cantidadActual, precio, total)
								console.log(saldoActual);
								$("#txtCantidad" + fila).val("1")
								$("#txtTotal").html("Total: " + Obtener_Total())
								//$("#txtSaldoRestante").val(saldoActual)
								//$('#popupCarrito').fadeIn('slow');
								$("#btnPagar").css({"visibility": "visible"});
								//alert("Agregado con exito el producto");
								alertify.success("¡Producto agregado con exito!");	
								var SaldoCredencial = localStorage.getItem("SaldoCredencial");
								$("#btnMas" + fila).attr("data-max", (CantidadMaxima - cantidadActual))
								var total = Obtener_Total();
								var saldo = parseFloat(SaldoCredencial) - total;
								$("#txtSaldoCredencial").val(saldo);
								//EnviarDatos({codigoProducto: codigoProducto, cantidad: cantidadActual}, "ActionDisminuirStock.php", "");
								verPedido();
							}else{
								alertify.alert("El saldo no es suficiente para agregar este producto!", function(){
									//$("#btnPagar").css({"visibility": "hidden"});
								});	
							}
							
							
											
						});
					}else{
						$("#Productos").html("");
						$("#Productos").append('<h1>No existen productos por el momento en esta subcategoria</h1>');
					}
				});
			}
			$("#btnPagar").click(function(e) {
				if(numeroVeces == 0){


					var idCredencialSesion = localStorage.getItem("idCredencialSesion"); 
					var usuario = localStorage.getItem("idUsuarioApp"); 
					var total = Obtener_Total()
					var descripcion = Obtener_Descripcion();
					var tipo = $("input[name='tipo']:checked").val();
					var hora = $("#txtHora").val()
					var fecha = $("#txtFecha").val()
					var estadoEntregaInmediata = $("#toggle-event").prop('checked');
					var datos;
					console.log(idCredencialSesion);
					/*
						Descripcion: Obtener fecha y hora para registrar movimientos
					*/
					var date = new Date();
					var dia = date.getDate();
					var mes = (date.getMonth() + 1);
					var year = date.getFullYear();
					
					if(dia < 10) {
						dia = '0' + dia;
					} 
					
					if(mes < 10) {
						mes = '0' + mes;
					} 
					
					var fechaActual = year + "-" + mes + "-" + dia;
					var horaActual = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds(); 
					
					var detalle = Obtener_Detalle();
					
					if(estadoEntregaInmediata){
						if(tipo == "CONALISTAMIENTO"){
							datos = {
								idCredencial: idCredencialSesion,
								usuario: usuario,
								descripcionPedido: descripcion,
								ubicacionPedido: "ALISTAMIENTO",
								fecha: fechaActual,
								hora: horaActual,
								total: total,
								horaEntrega: "",
								fechaEntrega: "",
								detalle: detalle
							}	
						}else{
							datos = {
								idCredencial: idCredencialSesion,
								usuario: usuario,
								descripcionPedido: descripcion,
								ubicacionPedido: "ENTREGADO",
								fecha: fechaActual,
								hora: horaActual,
								total: total,
								horaEntrega: "",
								fechaEntrega: "",
								detalle: detalle
							}	
						}
						//alert(total);
						
						$.post("ActionInsertarPedido.php", datos)
						.done(function( data ) {
							alert("¡Pedido Creado con exito!");
							localStorage.removeItem("idUsuarioApp");
							localStorage.removeItem("idCredencialSesion");
							window.location.href = "Cajero.html";
						
						});	
						
					}else{
						if($.trim(hora) != "" && $.trim(fecha) != ""){
							datos = {
								idCredencial: idCredencialSesion,
								usuario: usuario,
								descripcionPedido: descripcion,
								ubicacionPedido: "PLANIFICADO",
								fecha: fechaActual,
								hora: horaActual,
								total: total,
								horaEntrega: hora,
								fechaEntrega: fecha,
								detalle: detalle
							}	
							$.post("ActionInsertarPedido.php", datos)
							.done(function( data ) {
								alert("¡Pedido Creado con exito!");
								localStorage.removeItem("idUsuarioApp");
								localStorage.removeItem("idCredencialSesion");
								window.location.href = "Cajero.html";
							
							});	
						}else{
							if($.trim(hora) == ""){
								alert("Debe ingresar una hora valida");
							}
							if($.trim(fecha) == ""){
								alert("Debe ingresar una fecha valida");
							}
						}
					}
				
					numeroVeces++;
				}
			});
			function Obtener_Total(){
				var total = 0;
				
				$.each(jsonCarrito, function(i, item) {
					if(jsonCarrito[i] != null){
						total += parseInt(jsonCarrito[i].total);
					}
				});	
				return total;
			}
			function InsertarDetalleOrden(id){
				var total = 0;
				
				$.each(jsonCarrito, function(i, item) {
					if(jsonCarrito[i] != null){
						$.post("ActionAgregarProductosOrdePedido.php", {codigoProducto: jsonCarrito[i].codigoProducto, cantidad: jsonCarrito[i].cantidad, total: jsonCarrito[i].total, id: id})
						.done(function( data ) {
							
						});
						total += 1;
					}
				});	
				return total;
			}
			function DisminuirStock(){
				var total = 0;
				$.each(jsonCarrito, function(i, item) {
					if(jsonCarrito[i] != null){
						EnviarDatos({codigoProducto: jsonCarrito[i].codigoProducto, cantidad: jsonCarrito[i].cantidad}, "ActionDisminuirStock.php", "");
						total += 1;
					}
				});	
				return total;
			}
			function Obtener_Descripcion(){
				var descripcion = "";
				
				$.each(jsonCarrito, function(i, item) {
					if(jsonCarrito[i] != null){
						if(i != (jsonCarrito.length - 1)){						
							descripcion += jsonCarrito[i].cantidad + " " + jsonCarrito[i].nombre + ", ";
						}else{
							descripcion += jsonCarrito[i].cantidad + " " + jsonCarrito[i].nombre;
						}
					}
				});	
				return descripcion;
			}
			function Obtener_Detalle(){
				var descripcion = "";
				
				$.each(jsonCarrito, function(i, item) {
					if(jsonCarrito[i] != null){
						if(i != (jsonCarrito.length - 1)){						
							descripcion += jsonCarrito[i].codigoProducto + ":" + jsonCarrito[i].cantidad + ":" + jsonCarrito[i].total + ",";
						}else{
							descripcion += jsonCarrito[i].codigoProducto + ":" + jsonCarrito[i].cantidad + ":" + jsonCarrito[i].total;
						}
					}
				});	
				return descripcion;
			}
			function verPedido(){
				var html = '';
				console.log(jsonCarrito);
				$("#tbody").html("");
				$.each(jsonCarrito, function(i, item) {
					if(jsonCarrito[i] != null){
						if((i + 1) % 2 == 1){
							$("#tbody").append('<tr class="even" validrow="true">' +
								'<td>' + jsonCarrito[i].nombre + '</td>' +
								'<td>' + jsonCarrito[i].precioUnitario + '</td>' +
								'<td>' + jsonCarrito[i].cantidad + '</td>' +
								'<td>' + jsonCarrito[i].total + '</td>' +
								'<td><img src="images/stop.png" width="20" id="borrar' + i + '"/></td>' +
							'</tr>');						
						}else{
							$("#tbody").append('<tr class="odd" validrow="true">' +
								'<td>' + jsonCarrito[i].nombre + '</td>' +
								'<td>' + jsonCarrito[i].precioUnitario + '</td>' +
								'<td>' + jsonCarrito[i].cantidad + '</td>' +
								'<td>' + jsonCarrito[i].total + '</td>' +
								'<td><img src="images/stop.png" width="20" id="borrar' + i + '"/></td>' +
							'</tr>');						
						}
						$("#borrar" + i).click(function(e) {
							var confirmarAccion = window.confirm("¿Desea borrar este producto solicitado?");
							if(confirmarAccion){
								delete jsonCarrito[i];
								verPedido();
								var SaldoCredencial = localStorage.getItem("SaldoCredencial");
								var total = Obtener_Total();
								var saldo = parseFloat(SaldoCredencial) - total;
								$("#txtSaldoCredencial").val(saldo);
								$("#txtTotal").html("Total: " + Obtener_Total())
								
								var idSucategoriaElegida = localStorage.getItem("idSucategoriaElegida"); 
								var idUsuarioApp = localStorage.getItem("idUsuarioApp"); 
								var idCredencialSesion = localStorage.getItem("idCredencialSesion"); 
								//EnviarDatos({subcategoria: id, dia: dia, idUsuario: idUsuarioApp}, "ActionListarProductoSubCategoria.php", "LISTARPRODUCTOSSUB");
								$("#Productos").html("");
								ListarProductos(idSucategoriaElegida, idUsuarioApp, idCredencialSesion);
							}
						});
					}					 
				});
				
				//var tf = new TableFilter('demo', filtersConfig);
				//tf.init();
				$('#popupCarrito').fadeIn('slow');
			}

			function Obtener_Index(codigoProducto){
				var index = -1;
				
				$.each(jsonCarrito, function(i, item) {
					if(jsonCarrito[i] != null){
						if(codigoProducto == jsonCarrito[i].codigoProducto){	
							index = i;
						}
					}
					
				});	
				return index;
			}
			function ActualizarPedido(codigoProducto, nombre, cantidadActual, precio, total){
				var index = Obtener_Index(codigoProducto);
				
				if(index > -1)	{
					
					var totalActual = jsonCarrito[index].cantidad + cantidadActual
					jsonCarrito[index].codigoProducto = codigoProducto;
					jsonCarrito[index].nombre = nombre;
					jsonCarrito[index].cantidad = totalActual;
					jsonCarrito[index].precioUnitario = precio;
					jsonCarrito[index].total = total;
				}else{
					jsonCarrito.push(
						{codigoProducto: codigoProducto, nombre: nombre, cantidad: cantidadActual, precioUnitario: precio, total: total}
					);
				}
				
			}
		</script>





    </body>
</html>
<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1" />
        
        <link href="css/style.css" rel="stylesheet"/>
        <link href="css/menu.css" rel="stylesheet"/>
        <script type="text/javascript" src="js/jquery-1.10.2.js"></script>
        <script type="text/javascript" src="js/style.js"></script>	
        <script type="text/javascript" src="js/ConexionWebService.js"></script>
        <!--<script type="text/javascript" src="js/ValidacionUsuario.js"></script>-->
        <script src="js/script.js"></script>
        <script src="js/jquery-1.9.1.min.js"></script>
        <style>
        	label{
				font-family:'Palatino Linotype', 'Book Antiqua', Palatino, serif;
			}
        </style>
        <title>Cambios de Proteinas</title>
    </head>
    <body id="bodyBase">
    	<h2 align="right" style="margin-top:3%; margin-right:2%; color:#00C">Cambios de Proteinas</h2>
        <div id='cssmenu' style="width:3%">
            
        </div>
        <div style="margin-left:2%; margin-top:40px; position:absolute" id="divProteinas">
        	
         
        </div>
        <div class="contenidoBorde" style="width:86%; margin-top:-15px; border:0; border-color:#CCC; overflow:hidden; padding:0; height:72%; float:right" align="center">
        	<table width="100%" cellpadding="0" cellspacing="0" border="1" id="tablaTurno">
				<tr class="tr">
                    <td width="33%" align="center" id="td1">
                        <img src="images/stock_people.png" style="float:left; margin-left:5px;" class="img" id="imagenCelda1" onerror="imgError(1)"/>
                        <label style="color:#000; font-size:30px; " id="turnoCelda1"></label><br>
                        <label style="color:#000; font-size:20px" id="nombreCelda1"></label>
                        
                    </td>
                    <td width="33%" align="center" id="td2">
                        <img src="images/stock_people.png" style="float:left; margin-left:5px" class="img" id="imagenCelda2" onerror="imgError(2)"/>
                        <label style="color:#000; font-size:30px; " id="turnoCelda2"></label><br>
                        <label style="color:#000; font-size:20px" id="nombreCelda2"></label>
                        
                    </td>
                    <td width="33%" align="center" id="td3">
                        <img src="images/stock_people.png" style="float:left; margin-left:5px" class="img" id="imagenCelda3" onerror="imgError(3)"/>
                        <label style="color:#000; font-size:30px; " id="turnoCelda3"></label><br>
                        <label style="color:#000; font-size:20px" id="nombreCelda3"></label>
                        
                    </td>
                </tr>
                <tr height="5px">
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr class="tr">
                    <td width="33%" align="center" id="td4">
                        <img src="images/stock_people.png" style="float:left; margin-left:5px" class="img" id="imagenCelda4" onerror="imgError(4)"/>
                        <label style="color:#FF0000; font-size:30px; " id="turnoCelda4"></label><br>
                        <label style="font-size:20px" id="nombreCelda4"></label>
                    </td>
                    <td width="33%" align="center" id="td5">
                        <img src="images/stock_people.png" style="float:left; margin-left:5px" class="img" id="imagenCelda5" onerror="imgError(5)"/>
                        <label style="color:#FF0000; font-size:30px; " id="turnoCelda5"></label><br>
                        <label style="font-size:20px" id="nombreCelda5"></label>
                    </td>
                    <td width="33%" align="center" id="td6">
                        <img src="images/stock_people.png" style="float:left; margin-left:5px" class="img" id="imagenCelda6" onerror="imgError(6)"/>
                        <label style="color:#FF0000; font-size:30px; " id="turnoCelda6"></label><br>
                        <label style="font-size:20px" id="nombreCelda6"></label>
                    </td>
                </tr>
                <tr height="5px">
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr class="tr">
                   <td width="33%" align="center" id="td7">
                        <img src="images/stock_people.png" style="float:left; margin-left:5px" class="img" id="imagenCelda7" onerror="imgError(7)"/>
                        <label style="color:#FF0000; font-size:30px; " id="turnoCelda7"></label><br>
                        <label style="font-size:20px" id="nombreCelda7"></label>
                    </td>
                    <td width="33%" align="center" id="td8">
                        <img src="images/stock_people.png" style="float:left; margin-left:5px" class="img" id="imagenCelda8" onerror="imgError(8)"/>
                        <label style="color:#FF0000; font-size:30px; " id="turnoCelda8"></label><br>
                        <label style="font-size:20px" id="nombreCelda8"></label>
                    </td>
                    <td width="33%" align="center" id="td9">
                        <img src="images/stock_people.png" style="float:left; margin-left:5px" class="img" id="imagenCelda9" onerror="imgError(9)"/>
                        <label style="color:#FF0000; font-size:30px; " id="turnoCelda9"></label><br>
                        <label style="font-size:20px" id="nombreCelda9"></label>
                    </td>
                </tr>
            </table>
        </div>
		<script>
			function imgError(fila){
				$("#imagenCelda" + fila).attr("src", "images/stock_people.png");
			}
        	window.addEventListener('load',init);
			var iterator = 0;
			function init(){
				/*var usuarioSesion = localStorage.getItem("usuario"); 
				console.log(usuarioSesion);
				$("#usuarioSesion").html(usuarioSesion);*/
				var alto = parseInt($(".contenidoBorde").css("height"));
				var altoImg = (alto / 3) - 30;
				//alert($(".contenidoBorde").css("height"));
				$(".img").css({"height": altoImg});
				$(".tr").attr({"height":altoImg});
				//alert(altoImg);
				$("#tablaTurno").css({"height":alto});
				ListarEstudiantes();
				ListarProteinas();					
			}
			setInterval(function(){ListarEstudiantes()}, 180000);
			function ListarEstudiantes(){
				var date = new Date();
				var dia = date.getDate();
				var mes = (date.getMonth() + 1);
				var year = date.getFullYear();
				
				if(dia < 10) {
					dia = '0' + dia;
				} 
				
				if(mes < 10) {
					mes = '0' + mes;
				} 
				
				var fechaActual = dia + "/" + mes + "/" + year;
				var horaActual = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds(); 
				var dia = date.getDay();
				var datos = {
					dia: dia,
					fecha: fechaActual		
				}	
				$.post("http://181.55.254.193/ssca/ActionListarCambiosProteina.php", datos)
				.done(function( data ) {
					console.log(data);
					if($.trim(data) != "[]"){
						var jsonDatos = JSON.parse(data);
						
						var numeroCuadros = localStorage.getItem("numeroCuadros");
						
						//var iterator = parseInt(numeroCuadros);
						
						if(iterator <= jsonDatos.length){
							contador = 1;
							console.log(jsonDatos.length + " - " + iterator);
							for(i = iterator; i < (iterator + 9); i++){
								
								
								if(jsonDatos[i] != null){
									//$(".contenidoBorde").append(jsonDatos[i].primerNombre + " " + jsonDatos[i].primerApellido + " " + jsonDatos[i].segundoApellido + " - ");
									$("#imagenCelda" + contador).attr("src", "http://181.55.254.193/ssca/" + jsonDatos[i].ImagenFotografica);
									$("#turnoCelda" + contador).html(jsonDatos[i].primerNombre + " " + jsonDatos[i].primerApellido + " " + jsonDatos[i].segundoApellido);
									$("#nombreCelda" + contador).html(jsonDatos[i].Proteina);
									$("#td" + contador).css({"background-color":jsonDatos[i].color})		
									contador++;			
								}else{
									$("#imagenCelda" + contador).attr("src", "");
									$("#turnoCelda" + contador).html("");
									$("#nombreCelda" + contador).html("");
									$("#td" + contador).css({"background-color":"#FFF"})	
								}

							}
							$(".contenidoBorde").append("<br><br>");
							
							iterator++;
							//localStorage.setItem("numeroCuadros",iterator);
						}
						
					}
				});		
			}
			
			function ListarProteinas(){
				$.post("http://181.55.254.193/ssca/ActionListarProteinas.php", {})
				.done(function( data ) {
					$("#divProteinas").html();
					if($.trim(data) != "[]"){
						var json = JSON.parse(data);
						console.log(data);
						
						for(i = 0; i < json.length; i++){
							if(i == 0){
								$("#divProteinas").append('<div style="width:20px; height:20px; background-color:' + json[i].color + '">&nbsp;</div><label style="float:left; margin-top:-20px; margin-left:22px">' + json[i].Descripcion + '</label>');
							}else{
								$("#divProteinas").append('<div style="width:20px; height:20px; background-color:' + json[i].color + '; margin-top:5px">&nbsp;</div><label style="float:left; margin-top:-20px; margin-left:22px">' + json[i].Descripcion + '</label>');
							}							
						}
					}
				});			
			}
			
			//setTimeout(function(){window.location.href = "CambiosProteinas.html";}, 3000);
        </script>		
           
    </body>
</html>

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Administración de credenciales</title>
<link href="css/style.css" rel="stylesheet"/>
<link href="css/menu.css" rel="stylesheet"/>
<link href="css/popup.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery-1.10.2.js"></script>
<script type="text/javascript" src="js/style.js"></script>	
<script type="text/javascript" src="js/ConexionWebService.js"></script>
<script type="text/javascript" src="js/ValidacionUsuario.js"></script>
<script src="js/script.js"></script>
<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<link rel="stylesheet" media="screen" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.min.css">
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/alertify.js"></script>
<link rel="stylesheet" href="css/alertify.core.css" />
<link rel="stylesheet" href="css/alertify.default.css" />
<style>
      input, button{
        border-radius:7px;
      }
      label, select{
        color:#000;
      }
      a{
        text-decoration:none;
      }
            h2 {
                 text-shadow: 0px 2px 3px #555;
               }
    </style>
</head>

<body id="bodyBase">
<h4 style="color:#CCC;margin-left:10px; margin-top:5px">Modulo Administraci&oacute;n de credenciales</h4>
<h4 align="right" style="color:#FFF;margin-left:10px; margin-top:5px; margin-right: 10px">Bienvenido(a): <label id="usuarioSesion" style="color:#FFF"></label></h4>
        <h2 align="right" style="margin-top:2%; margin-right:2%; color:#09C">Administraci&oacute;n de credenciales</h2>
        <div id='cssmenu'>
            <ul>
               <li class='' style="display:none" id="AdminCredenciales" class="desactive"><a href='#' title="Admin.Credenciales">ADMINISTRACIÓN DE CREDENCIALES</a>
                  <ul style="margin-right:-42%">
                     <li id="ReemplazoCredencial" style="display:none"><a href='ReemplazarCredencial.html' title="Reemplazo de credenciales">Reemplazo de credenciales</a></li>
                     <li class='last'><a href='AdminCredencial.html' title="Cambio de Estado">CAMBIO DE ESTADO</a></li>
                     <li class='last'><a href='ConsultaMovimientosAcudiente.html' title="Consulta de Movimientos">CONSULTA DE MOVIMIENTOS</a></li>
                     <li class='last'><a href='ConsultaSaldo.html' title="Consulta de Saldos">CONSULTA DE SALDOS</a></li>
                     <li class='last'><a href='ServicioProximoRecargaLinea.php' title="Recarga en Linea">RECARGA EN LINEA</a></li>
                     <li class='last'><a href='TrasladoCredencialAcudiente.html' title="Traslado de Fondos entre Credenciales">TRASLADO DE FONDOS ENTRE CREDENCIALES</a></li>
                  </ul>
               </li>
               
               <li class="" id="RutaEscolar" style="display:none" class="desactive"><a href='#' title="Ruta Escolar">RUTA ESCOLAR</a>
                    <ul style="margin-right:-42%">
                        <li><a href='EnvioMensajesMonitor.html' title="Envío de Mensajes">ENVÍO DE MENSAJES</a></li>
                        <li class='last' title="Tracking"><a href="javascript:void(0);" onclick="enviar_variables();">TRACKING</a></li>
                        <li><a href='#' title="Información de la Ruta">INFORMACIÓN DE LA RUTA</a></li>
                    </ul>
               </li>
               <li class="" id="RestriccionConsumo" style="display:none" class="desactive"><a href='#' title="Restricci&oacute;n de Consumo">RESTRICCI&Oacute;N DE CONSUMO</a>
                    <ul style="margin-right:-42%">
                      <li><a href='RestriccionConsumoValor.html' title="Restricciones por Valor">RESTRICCIONES POR VALOR</a></li>
                      <li><a href='RestriccionConsumoProducto.html' title="Restricciones por Producto">RESTRICCIONES POR PRODUCTO</a></li>
                  </ul>
               </li>
                <li class="" id="RestauranteAcudientes" style="display:none" class="desactive">
                  <a href='#' title="Restaurante">RESTAURANTE</a>
                  <ul style="margin-right:-42%">
                    <li>
                      <a href='MenuSemanal.html' title="Menú Semanal"> 
                        MENÚ SEMANAL
                      </a>
                    </li>
                  </ul>
                </li>              
               
                <li class="" id="Modificacion Datos Perfil" style="display:none" class="desactive"><a href='ModificarAcudiente.html' title="Modificacion Datos Perfil">Modificacion Datos Perfil</a>
                    <ul style="margin-right:-42%">    
                    </ul>
                 </li>
               <li class="" id="Salir"><a href='#' title="Cerrar Sesi&oacute;n">CERRAR SESI&Oacute;N</a>
                    <ul style="margin-right:-42%">
                        
                    </ul>
               </li>
            </ul>

          

        </div>
<div class="contenidoBorde" align="center"><br/>
    <table style="padding-left:4%; padding-top:4.5%;padding-right:20px;" cellspacing="0" cellpadding="0" width="80%">
        <tr>
            <td><label for="selectIdCredencial"><font color="#09C" size="2">ID CREDENCIAL:</font></label></td>
            <td><select id="selectIdCredencial" name="selectIdCredencial" class="form-control"></select></td>        
        </tr>
        <tr>
            <td><label for="txtPrimerApellido"><font color="#09C" size="2">Primer Apellido:</font></label></td>
            <td><input type="text" name="txtPrimerApellido" id="txtPrimerApellido" disabled class="form-control"/></td>        
        </tr>
        <tr>
            <td><label for="txtSegundoApellido"><font color="#09C" size="2">Segundo Apellido:</font></label></td>
            <td><input type="text" name="txtSegundoApellido" id="txtSegundoApellido" disabled class="form-control"/></td>        
        </tr>
        <tr>
            <td><label for="txtPrimerNombre"><font color="#09C" size="2">Primer Nombre:</font></label></td>
            <td><input type="text" name="txtPrimerNombre" id="txtPrimerNombre" disabled class="form-control"/></td>        
        </tr>
        <tr>
            <td><label for="txtSegundoNombre"><font color="#09C" size="2">Segundo Nombre:</font></label></td>
            <td><input type="text" name="txtSegundoNombre" id="txtSegundoNombre" disabled class="form-control"/></td>        
        </tr>
        <tr>
            <td><label for="txtDirección"><font color="#09C" size="2">Direcci&oacute;n:</font></label></td>
            <td><input type="text" name="txtDirección" id="txtDireccion" disabled class="form-control"/></td>        
        </tr>
        <tr>
            <td><label for="txtTelefono1"><font color="#09C" size="2">Tel&eacute;fono 1:</font></label></td>
            <td><input type="tel" name="txtTelefono1" id="txtTelefono1" disabled class="form-control"/></td>        
        </tr>
        <tr>
            <td><label for="txtTelefono2"><font color="#09C" size="2">Tel&eacute;fono 2:</font></label></td>
            <td><input type="tel" name="txtTelefono2" id="txtTelefono2" disabled class="form-control"/></td>        
        </tr>
        <tr>
            <td valign="top"><label for="selectAcudiente"><font color="#09C" size="2">Estado de credencial:</font></label></td>
            <td><input type="radio" name="radioEstado" id="radioEstadoActivo" value="ACTIVO"/><label for="radioEstadoActivo"><font color="#09C" size="2">ACTIVO</font></label><br><input type="radio" name="radioEstado" id="radioEstadoInactivo" value="INACTIVO"/><label for="radioEstadoInactivo"><font color="#09C" size="2">INACTIVO</font></label></td>        
        </tr>
         
        <tr>
            <td>&nbsp;</td>
            <td align="right"><button type="button" name="btnGrabarCambios" id="btnGrabarCambios" class="btn btn-primary" style="display: none;"><b>GRABAR CAMBIOS </b></button></td>
        </tr>
        
        
    </table>
</div>
	
<script type="text/javascript">
	/*
		Fecha: 			Octubre 22 de 2015
		Descripcion: 	Script para enviar los datos al webservice para que los inserte en la base de datos
	
	*/
	
	//Valor guardado cuando se cierra un popup y se concreto una operación
	var opcionSeleccionar = "";
		
	//Capturar evento del boton crear
	$("#btnGrabarCambios").click(function(e) {
		//Se obtienen los datos a enviar		
		var usuarioIngresado = $("#selectIdCredencial").val();
		var estado = $("input[name='radioEstado']:checked").val(); ;
		
		/*
			Descripcion: Obtener fecha y hora para registrar movimientos
		*/
		var date = new Date();
		var dia = date.getDate();
		var mes = (date.getMonth() + 1);
		var year = date.getFullYear();
		var saldo = 500;
		
		if(dia < 10) {
			dia = '0' + dia;
		} 
		
		if(mes < 10) {
			mes = '0' + mes;
		} 
		
		var fechaActual = year + "-" + mes + "-" + dia;
		var horaActual = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds(); 
		
		//Se guardan los datos en un JSON
		var usuario = {
            usuario: usuarioIngresado,
			estado: estado,
			saldo: saldo,
			fecha: fechaActual,
			hora: horaActual
        }		
		
		//Se envian a la funcion que realiza la conexion al werbservice y genera una respuesta que se guarda en un localstorage
		EnviarDatos(usuario, "ActioAdministrarCredencial.php", "ADMINCREDENCIAL");
		
		$("#txtPrimerApellido").val("");
		$("#txtSegundoApellido").val("");
		$("#txtPrimerNombre").val("");
		$("#txtSegundoNombre").val("");
		$("#txtDireccion").val("");
		$("#txtTelefono1").val("");
		$("#txtTelefono2").val("");
		$("#txtClave").val("");
		$("#txtAcudiente").val("");
		$("#txtTipoUsuario").val("");
		$("#txtUsuario").val("");

    var usuarioSesion = localStorage.getItem("usuario"); 
    $.post("ActionListarCredencialesAcudiente.php", {acudiente: usuarioSesion})
      .done(function( data ) {
        
        $("#selectIdCredencial").html("")
        if($.trim(data) != "[]"){
          $("#selectIdCredencial").append('<option value="SELECCIONE">Seleccione...</option>');
          
          var json = JSON.parse(data);
          $.each(json, function(i, item) {
            $("#selectIdCredencial").append('<option value="' + json[i].usuario + '">' + json[i].primerNombre + ' ' + json[i].segundoNombre + ' ' + json[i].primerApellido + ' ' + json[i].segundoApellido + '</option>');
          });
        }
      }); 
		
    });
	
	$("#selectIdCredencial").change(function(e) {
      if($(this).val() != "SELECCIONE"){
        var usuarioSesion = localStorage.getItem("usuario"); 
          var usuarioConsultar = $("#selectIdCredencial").val();
        EnviarDatos({usuario: usuarioConsultar}, "ActionConsultarUsuarioPorId.php", "CONSULTARUSUARIOREEMPLAZOC");
        $("#btnGrabarCambios").css({"display":"block"});
      }else{
       $("#txtPrimerApellido").val("");
    $("#txtSegundoApellido").val("");
    $("#txtPrimerNombre").val("");
    $("#txtSegundoNombre").val("");
    $("#txtDireccion").val("");
    $("#txtTelefono1").val("");
    $("#txtTelefono2").val("");
    $("#txtClave").val("");
    $("#txtAcudiente").val("");
    $("#txtTipoUsuario").val("");
    $("#txtUsuario").val("");
    $("#btnGrabarCambios").css({"display":"none"});
      }
    });
	window.addEventListener('load',init);
	function init(){
		var usuarioSesion = localStorage.getItem("primernombreusuario") + " " + localStorage.getItem("segundonombreusuario") + " " + localStorage.getItem("primerapellidousuario") + " " + localStorage.getItem("segundoapellidousuario"); 
		
		$("#usuarioSesion").html(usuarioSesion);
		//Se envian a la funcion que realiza la conexion al werbservice y genera una respuesta que se guarda en un localstorage
    var usuarioSesion = localStorage.getItem("usuario");
    $.post("ActionListarCredencialesAcudiente.php", {acudiente: usuarioSesion})
      .done(function( data ) {
        
        $("#selectIdCredencial").html("")
        if($.trim(data) != "[]"){
          $("#selectIdCredencial").append('<option value="SELECCIONE">Seleccione...</option>');
          
          var json = JSON.parse(data);
          $.each(json, function(i, item) {
            $("#selectIdCredencial").append('<option value="' + json[i].usuario + '">' + json[i].primerNombre + ' ' + json[i].segundoNombre + ' ' + json[i].primerApellido + ' ' + json[i].segundoApellido + '</option>');
          });
        }
      }); 

	}
	
$("#Salir").click(function(e) {
    var confirmar = window.confirm("¿Desea cerrar sesión?");
    if(confirmar){
      localStorage.removeItem("usuario");
      localStorage.removeItem("tipoUsuario");
      localStorage.removeItem("primernombreusuario");
      localStorage.removeItem("segundonombreusuario");
      localStorage.removeItem("primerapellidousuario");
      localStorage.removeItem("segundoapellidousuario");
      window.location.href = "index.html";
    }
  });

  function enviar_variables(){
    var usuarioSesion = localStorage.getItem("usuario");
    location.href="TrackingPadres.php?proced="+ usuarioSesion;
  } 
	
</script>
</body>
</html>

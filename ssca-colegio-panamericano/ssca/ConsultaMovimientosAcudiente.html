<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>CONSULTA DE MOVIMIENTOS</title>
<link href="css/style.css" rel="stylesheet"/>
<link href="css/menu.css" rel="stylesheet"/>
<link href="css/popup.css" rel="stylesheet"/>
<link rel="stylesheet" type="text/css" href="dist/tablefilter/style/tablefilter.css">
<script type="text/javascript" src="js/jquery-1.10.2.js"></script>
<script type="text/javascript" src="js/style.js"></script>	
<script type="text/javascript" src="js/ConexionWebService.js"></script>
<script type="text/javascript" src="js/ValidacionUsuario.js"></script>
<script src="js/script.js"></script>
<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<link rel="stylesheet" media="screen" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.min.css">
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/alertify.js"></script>
<link rel="stylesheet" href="css/alertify.core.css" />
<link rel="stylesheet" href="css/alertify.default.css" />
<style>
          input, select{
        border-radius:8px;
        
        }
  h3 {
        text-shadow: 0px 2px 3px #555;
        }
</style>
</head>

<body id="bodyBase">
<h5 style="color:#CCC;margin-left:10px; margin-top:5px">Modulo Consulta de Movimientos</h5>
<h4 align="right" style="color:#FFF;margin-left:10px; margin-top:5px; margin-right: 10px">Bienvenido(a): <label id="usuarioSesion" style="color:#FFF"></label></h4>
    <h3 align="right" style="margin-top:2%; margin-right:2%; color:#09C">CONSULTA DE MOVIMIENTOS</h3>
	<div id='cssmenu'>
            <ul>
               <li class='' style="display:none" id="AdminCredenciales" class="desactive"><a href='#' title="Admin.Credenciales">ADMINISTRACIÓN DE CREDENCIALES</a>
                  <ul style="margin-right:-42%">
                     <li id="ReemplazoCredencial" style="display:none"><a href='ReemplazarCredencial.html' title="Reemplazo de credenciales">Reemplazo de credenciales</a></li>
                     <li class='last'><a href='AdminCredencial.html' title="Cambio de Estado">CAMBIO DE ESTADO</a></li>
                     <li class='last'><a href='ConsultaMovimientosAcudiente.html' title="Consulta de Movimientos">CONSULTA DE MOVIMIENTOS</a></li>
                     <li class='last'><a href='ConsultaSaldo.html' title="Consulta de Saldos">CONSULTA DE SALDOS</a></li>
                     <li class='last'><a href='ServicioProximoRecargaLinea.php' title="Recarga en Linea">RECARGA EN LINEA</a></li>
                     <li class='last'><a href='TrasladoCredencialAcudiente.html' title="Traslado de Fondos entre Credenciales">TRASLADO DE FONDOS ENTRE CREDENCIALES</a></li>
                  </ul>
               </li>
               
               <li class="" id="RutaEscolar" style="display:none" class="desactive"><a href='#' title="Ruta Escolar">RUTA ESCOLAR</a>
                    <ul style="margin-right:-42%">
                        <li><a href='EnvioMensajesMonitor.html' title="Envío de Mensajes">ENVÍO DE MENSAJES</a></li>
                        <li class='last' title="Tracking"><a href="javascript:void(0);" onclick="enviar_variables();">TRACKING</a></li>
                        <li><a href='#' title="Información de la Ruta">INFORMACIÓN DE LA RUTA</a></li>
                    </ul>
               </li>
               <li class="" id="RestriccionConsumo" style="display:none" class="desactive"><a href='#' title="Restricci&oacute;n de Consumo">RESTRICCI&Oacute;N DE CONSUMO</a>
                    <ul style="margin-right:-42%">
                      <li><a href='RestriccionConsumoValor.html' title="Restricciones por Valor">RESTRICCIONES POR VALOR</a></li>
                      <li><a href='RestriccionConsumoProducto.html' title="Restricciones por Producto">RESTRICCIONES POR PRODUCTO</a></li>
                  </ul>
               </li>
                <li class="" id="RestauranteAcudientes" style="display:none" class="desactive">
                  <a href='#' title="Restaurante">RESTAURANTE</a>
                  <ul style="margin-right:-42%">
                    <li>
                      <a href='MenuSemanal.html' title="Menú Semanal"> 
                        MENÚ SEMANAL
                      </a>
                    </li>
                  </ul>
                </li>              
               
                <li class="" id="Modificacion Datos Perfil" style="display:none" class="desactive"><a href='ModificarAcudiente.html' title="Modificacion Datos Perfil">Modificacion Datos Perfil</a>
                    <ul style="margin-right:-42%">    
                    </ul>
                 </li>
               <li class="" id="Salir"><a href='#' title="Cerrar Sesi&oacute;n">CERRAR SESI&Oacute;N</a>
                    <ul style="margin-right:-42%">
                        
                    </ul>
               </li>
            </ul>

          

        </div>
    <div class="contenidoBorde">
      <br>
        <table style="margin-right: 10px; margin-left: 10px" cellspacing="0" cellpadding="0" width="90%">
            <tr>
                <td><label for="selectIdCredencial"><font color="#09C" size="2">ID CREDENCIAL:</font></label></td>
                <td><select id="selectIdCredencial" name="selectIdCredencial" class="form-control"></select></td>        
            </tr>
            <tr>
                <td><label for="dateFechaInicial"><font color="#09C" size="2">FECHA INICIAL:</font></label></td>
                <td><input type="date" name="dateFechaInicial" id="dateFechaInicial" class="form-control"/></td>        
            </tr>
            <tr>
                <td><label for="dateFechaFinal"><font color="#09C" size="2">FECHA FINAL:</font></label></td>
                <td><input type="date" name="dateFechaFinal" id="dateFechaFinal" class="form-control"/></td>        
            </tr>
            <tr>
                <td>&nbsp;</td>
                <td align="right"><button type="button" name="btnGenerarReporte" id="btnGenerarReporte" class="btn btn-primary"><b>GENERAR REPORTE</b></button></td>
            </tr>
        </table>
        <table id="demo" width="100%">
        <thead>
            <tr>
                <th><font color="#09C" size="2">Fecha</font></th>
                <th><font color="#09C" size="2">Hora</font></th>
                <th><font color="#09C" size="2">Descripcion</font></th>
                <th><font color="#09C" size="2">Valor</font></th>
            </tr>
        </thead>
        <tbody id="tbody">
            
            
        </tbody>
      </table>
        
	</div>
  <script src="dist/tablefilter/tablefilter.js"></script>
      <script>
            
                //Configuracion de la tabla    
                var filtersConfig = {
                    base_path: 'dist/tablefilter/',
                    paging: true,//Activar o no la paginacion
                    results_per_page: ['Filas: ', [10,25,50,100]],//Numero de registros a mostrar en cada pagina
                    auto_filter: true,//Aceptar o no filtro automatico cuando se empieza a escribir
                    auto_filter_delay: 1100, //milliseconds
                    filters_row_index: 1,
                    remember_page_number: true,
                    remember_page_length: true,
                    alternate_rows: true,
                    grid_layout: true,
                    grid_width: '100%',//Ancho de la tabla
                    alternate_rows: true,
                    btn_reset: true,//Activar el boton de resetear los campos de filtro
                    rows_counter: true,
                    loader: true,
                    status_bar: true,
                    col_0: 'none',//Configurar el filtro de la columna con select
                    col_1: 'none',//Configurar el filtro de la columna con select
                    col_2: 'none',//Configurar el filtro de la columna con select
                    col_3: 'none',//Configurar el filtro de la columna con select
                    col_4: 'none',//Configurar el filtro de la columna con select
                    col_5: 'none',//Configurar el filtro de la columna con select
                    col_6: 'none',//Configurar el filtro de la columna con select
                    
                    extensions:[
                        {
                            name: 'advancedGrid',
                            // For the purpose of this demo, ezEditTable dependency
                            // is loaded from its own website which is not a CDN.
                            // This dependency also requires a licence therefore
                            // DO NOT import it in this way in your projects.
                            filename: 'ezEditTable_min.js',
                            vendor_path: 'http://190.60.211.17/ssca/js/',
                            // Once ezEditTable dependency is installed in your
                            // project import it by pointing to a local path:
                            // vendor_path: 'path/to/ezEditTable'
                            editable: false,
                            selection: true,
                            default_selection: 'both',
                            editor_model: 'cell',
                            
                        }, {
                            name: 'sort',
                            types: [
                                'number', 'string', 'string',
                                'number', 'string', 'string',
                                'number'
                            ]
                        }
                    ]
                };
              var tf = new TableFilter('demo', filtersConfig);
                
            </script>          
<script type="text/javascript">
	/*
		Fecha: 			Octubre 24 de 2015
		Descripcion: 	Script para enviar los datos al webservice para que los inserte en la base de datos
	
	*/
	
	//Valor guardado cuando se cierra un popup y se concreto una operación
	var opcionSeleccionar = "";
		
	//Capturar evento del boton crear
	$("#btnGenerarReporte").click(function(e) {
		//Se obtienen los datos a enviar		
		var fechaInicial = $("#dateFechaInicial").val();
		var fechaFinal = $("#dateFechaFinal").val();
		var credencial = $("#selectIdCredencial").val();
		//Se guardan los datos en un JSON
		var datos = {
			credencial: credencial,
            fechaInicial: fechaInicial,
			fechaFinal: fechaFinal
        }	
		//Se envian a la funcion que realiza la conexion al werbservice y genera una respuesta que se guarda en un localstorage
		//EnviarDatos(datos, "ActionReporteMovimientosAcudiente.php", "REPORTEMOVIMIENTOS");	
		$.post("ActionReporteMovimientosAcudiente.php", datos)
    .done(function( data ) {
      console.log($.trim(data));
      var html = '';
      if($.trim(data) != "[]"){
        //alert("Se proceso con exito el recaudo");
        var json = JSON.parse(data);
        $.each(json, function(i, item) {
        if((i + 1) % 2 == 1){
             html += '<tr class="even" validrow="true">' +
              '<td>' + json[i].FechaMovimiento + '</td>' +
              '<td>' + json[i].HoraMovimiento + '</td>' +
              '<td>' + json[i].DescripcionMovimiento + '</td>' +
              '<td>' + json[i].ValorMovimiento + '</td>' +
            '</tr>';            
           }else{
             html += '<tr class="odd" validrow="true">' +
              '<td>' + json[i].FechaMovimiento + '</td>' +
              '<td>' + json[i].HoraMovimiento + '</td>' +
              '<td>' + json[i].DescripcionMovimiento + '</td>' +
              '<td>' + json[i].ValorMovimiento + '</td>' +
            '</tr>';
          }
          });
          $("#tbody").html(html);
          var tf = new TableFilter('demo', filtersConfig);
          tf.init();
        }
    });
		
		
    });
	
	window.addEventListener('load',init);
	function init(){
		var usuarioSesion = localStorage.getItem("primernombreusuario") + " " + localStorage.getItem("segundonombreusuario") + " " + localStorage.getItem("primerapellidousuario") + " " + localStorage.getItem("segundoapellidousuario"); 
		
		$("#usuarioSesion").html(usuarioSesion);
		//Se envian a la funcion que realiza la conexion al werbservice y genera una respuesta que se guarda en un localstorage
    var usuarioSesion = localStorage.getItem("usuario");
		EnviarDatos({acudiente: usuarioSesion}, "ActionListarCredencialesAcudiente.php", "LISTACREDENCIALESACUDIENTES");		
	}
	
	$("#Salir").click(function(e) {
    var confirmar = window.confirm("¿Desea cerrar sesión?");
    if(confirmar){
      localStorage.removeItem("usuario");
      localStorage.removeItem("tipoUsuario");
      localStorage.removeItem("primernombreusuario");
      localStorage.removeItem("segundonombreusuario");
      localStorage.removeItem("primerapellidousuario");
      localStorage.removeItem("segundoapellidousuario");
      window.location.href = "index.html";
    }
  });

  function enviar_variables(){
    var usuarioSesion = localStorage.getItem("usuario");
    location.href="TrackingPadres.php?proced="+ usuarioSesion;
  } 
</script>
</body>
</html>

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Nuevo Producto</title>
<link href="css/style.css" rel="stylesheet"/>
<link href="css/menu.css" rel="stylesheet"/>
<link rel="stylesheet" href="css/bootstrap.min.css">
<script type="text/javascript" src="js/jquery-1.10.2.js"></script>
<script type="text/javascript" src="js/style.js"></script>	
<script type="text/javascript" src="js/ConexionWebService.js"></script>
<!--<script type="text/javascript" src="js/ValidacionUsuario.js"></script>-->
<link rel="stylesheet" media="screen" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.min.css">
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script src="js/script.js"></script>
<script src="js/ValidacionNumerica.js" type="text/javascript"></script>
<link rel="stylesheet" href="css/bootstrap.min.css">
<style>
	label, select{
		color:#000;
	}
  h3 {
      text-shadow: 0px 2px 3px #555;
     }
</style>
</head>

<body id="bodyBase">
	<h4 style="color:#CCC;margin-left:10px; margin-top:5px">Cafeteria - Gestion Administrativa: <label id="usuarioSesion"></label></h4>
    <label style="float:right;margin-right:7%; margin-top:-20px"><font color="#FFFFFF" size="3"><a href="ModificarProducto.html" style="color:#FFF">Modificaci&oacute;n de Productos</a></font></label><label style="float:right; margin-right:20px; margin-top:-20px; color:#FFF">|</label><label style="float:right; margin-right:40px; margin-top:-20px"><font color="#FFFFFF" size="3"><a href="#" style="color:#FFF">Creaci&oacute;n de Productos</a></font></label>
        <h3 align="right" style="margin-top:2%; margin-right:2%; color:#09C">Creaci&oacute;n de Productos</h3>
        <div id='cssmenu'>
            <ul>
               <li class="" id="AdminUsuarios" style="display:none"><a href='#' title="Admin.Usuarios"><h6><p class="full-circle"></p><span>Admin.Usuarios</span></h6></a>
                    <ul style="margin-right:-42%">
                         <li><a href='#' title="Usuarios Plataforma"><span>Usuarios Plataforma</span></a></li>
                         <li class='last' title="Usuarios Aplicaciones"><a href='AdminUsuariosAplicaciones.html'><span>Usuarios Aplicaciones</span></a></li>
					</ul>
               </li>
               <li class='' style="display:none" id="AdminCredenciales"><a href='#' title="Admin.Credenciales"><h6><p class="full-circle"></p><span>Admin.Credenciales</span></h6></a>
                  <ul style="margin-right:-42%">
                     <li id="ReemplazoCredencial" style="display:none"><a href='ReemplazarCredencial.html' title="Reemplazo de credenciales"><span>Reemplazo de credenciales</span></a></li>
                     <li class='last'><a href='AdminCredencial.html' title="Cambio de Estado"><span>Cambio de Estado</span></a></li>
                     <li class='last'><a href='ConsultaMovimientosAcudiente.html' title="Consulta de Movimientos"><span>Consulta de Movimientos</span></a></li>
                     <li class='last'><a href='ConsultaSaldo.html' title="Consulta de Saldos"><span>Consulta de Saldos</span></a></li>
                     <li class='last'><a href='RecargueMonetarioAcudiente.html' title="Recarga en Linea"><span>Recarga en Linea</span></a></li>
                     <li class='last'><a href='TrasladoCredencialAcudiente.html' title="Traslado de Fondos entre Credenciales"><span>Traslado de Fondos entre Credenciales</span></a></li>
                  </ul>
               </li>
               <li class='' id="Liquidacion" style="display:none"><a href='#' title="Liquidaci&oacute;n y Pagos"><h6><p class="full-circle"></p><span>Liquidaci&oacute;n y Pagos</span></h6></a>
                  <ul style="margin-right:-42%">
                    
                  </ul>
               </li>
               <li class='' id="PuntosRecargue" style="display:none"><a href='#' title="Puntos de Recarga"><h6><p class="full-circle"></p><span>Puntos de Recarga</span></h6></a>
                  <ul style="margin-right:-42%">
                     
                  </ul>
               </li>
               <li class='' id="CentroOperacion" style="display:none"><a href='#' title="Centro - Operaciones Rutas"><h6><p class="full-circle"></p><span>Centro - Operaciones Rutas</span></h6></a>
                    <ul style="margin-right:-42%">
                         <li><a href='' title="Vehiculos"><span>Vehiculos</span></a></li>
                         <li><a href='CrearConductores.html' title="Conductores"><span>Conductores</span></a></li>
                         <li><a href='#' title="Monitores"><span>Monitores</span></a></li>
                         <li><a href='crearruta.php' title="v"><span>Rutas</span></a></li>
                         <li><a href='#' title="Centro de Pagos"><span>Centro de Pagos</span></a></li>
                         <li class='last' title="Tracking"><a href='menutracking.php'><span>Tracking</span></a></li>
                    </ul>
               </li>
               <li class="" id="RutaEscolar" style="display:none"><a href='#' title="Ruta Escolar"><h6><p class="full-circle"></p><span>Ruta Escolar</span></h6></a>
                    <ul style="margin-right:-42%">
                        
					</ul>
               </li>
               <li class="" id="RestriccionConsumo" style="display:none"><a href='#' title="Restricci&oacute;n de Consumo"><h6><p class="full-circle"></p><span>Restricci&oacute;n de Consumo</span></h6></a>
                    <ul style="margin-right:-42%">
                        
					</ul>
               </li>
               <li class="" id="RecargueCredencial" style="display:none"><a href='ProcesoRecaudo.html' title="Recargue de Credenciales"><h6><p class="full-circle"></p><span>Recargue de Credenciales</span></h6></a>
                    <ul style="margin-right:-42%">
                        
					</ul>
               </li>
               <li class="" id="Reportes" style="display:none"><a href='ReporteRecaudo.html' title="Reportes"><h6><p class="full-circle"></p><span>Reportes</span></h6></a>
                    <ul style="margin-right:-42%">
                        
					</ul>
               </li>
               <li class="" id="Salir"><a href='#' title="Cerrar Sesi&oacute;n"><h6><p class="full-circle"></p><span>Cerrar Sesi&oacute;n</span></h6></a>
                    <ul style="margin-right:-42%">
                        
					</ul>
               </li>
            </ul>
        </div>
        <div class="contenidoBorde" align="center" style="padding-top:20px">
            <table align="center">
                <tr>
                    <td><label for="txtCodigo"><font color="#09C" size="1">Codigo de Producto:</label></font></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="text" id="txtCodigo" name="txtCodigo" disabled/></td>  
                    <td width="5px">&nbsp;</td>
                    <td rowspan="12" valign="top">
                        <img src="" id="imageFoto" name="imageFoto" width="128px" height="128px"/><br>
                        <form method="post" id="formulario" enctype="multipart/form-data">
                            <font color="#09C" size="1">Seleccionar imagen:</font><br><input class="btn btn-primary" type="file" id="fileFoto" name="fileFoto"/>
                         </form>            
                        </td>
                    </td>      
                </tr>
                <tr>
                    <td><label for="txtNombre"><font color="#09C" size="1">Nombre del Producto:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="text" name="txtNombre" id="txtNombre"/></td>        
                </tr>
                <tr>
                    <td><label for="txtDescripcion"><font color="#09C" size="1">Descripcion del producto:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="text" name="txtDescripcion" id="txtDescripcion"/></td>        
                </tr>
                <tr>
                    <td><label for="txtValor"><font color="#09C" size="1">Valor del producto:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="text" name="txtValor" id="txtValor"/></td>        
                </tr>
                <tr>
                    <td><label for="txtTiempo"><font color="#09C" size="1">Restriccion Tiempo:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="time" name="txtTiempo" id="txtTiempo"/></td>        
                </tr>
				<tr>
                    <td><label for="txtEdadMinima"><font color="#09C" size="1">Edad Minima:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="text" name="txtEdadMinima" id="txtEdadMinima"/></td>        
                </tr>
                <tr>
                    <td><label for="txtEdad"><font color="#09C" size="1">Edad Maxima:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="text" name="txtEdad" id="txtEdad"/></td>        
                </tr>
                <tr>
                    <td><label for="selectCategoria"><font color="#09C" size="1">Categor√≠a:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><select id="selectCategoria" name="selectCategoria"></select></td>        
                </tr>
                <tr>
                    <td><label for="txtTiempoC"><font color="#09C" size="1">Tiempo Cancelacion:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="time" name="txtTiempoC" id="txtTiempoC"/></td>        
                </tr>
                <tr>
                    <td><label for="selectSubcategoria"><font color="#09C" size="1">SubCategoria:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><select id="selectSubcategoria" name="selectSubcategoria"></select></td>        
                </tr>
                <tr>
                    <td><label for="txtEstado"><font color="#09C" size="1">ESTADO:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="radio" name="radioEstado" id="radioEstadoActivo" value="ACTIVO"/><label for="radioEstadoActivo"><font color="#09C" size="1">ACTIVO</font></label><br><input type="radio" name="radioEstado" id="radioEstadoInactivo" value="INACTIVO"/><label for="radioEstadoInactivo"><font color="#09C" size="1">INACTIVO</font></label></td>        
                </tr>
                <tr>
                    <td><label for="txtStock"><font color="#09C" size="1">STOCK:</font></label></td>
                    <td width="5px">&nbsp;</td>
                    <td><input type="text" name="txtStock" id="txtStock" min="1" value="1" onKeyUp="format(this)"/></td>        
                </tr>
                <tr>
                    <td colspan="5" height="10px">&nbsp;</td>                   
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td width="5px">&nbsp;</td>
                    <td align="right"><button type="button" name="btnCrearProducto" id="btnCrearProducto" class="btn btn-primary"><b>CREAR</b></button></td>
                </tr>
            </table>

		</div>
    
<script type="text/javascript">
	/*
		Fecha: 			Octubre 21 de 2015
		Descripcion: 	Script para enviar los datos al webservice para que los inserte en la base de datos
	
	*/
	
	//Valor guardado cuando se cierra un popup y se concreto una operaci√≥n
	var opcionSeleccionar = "";
	var fotoSeleccionada = "";
	
	function readImage() {
		//console.log(this.files);
		if ( this.files && this.files[0] ) {
			var FR = new FileReader();
			FR.onload = function(e) {
				 $('#imageFoto').attr( "src", e.target.result );
				 //$('#base').text( e.target.result );
				 //console.log(e.target.result);
				 fotoSeleccionada = e.target.result;
				 console.log(fotoSeleccionada);
			};       
			FR.readAsDataURL( this.files[0] );
		}
	}
	$("#fileFoto").change( readImage );
	//Capturar evento del boton crear
	$("#btnCrearProducto").click(function(e) {
		//Se obtienen los datos a ingresar
		
		var codigo = $("#txtCodigo").val();
		var nombre = $("#txtNombre").val();
		var descripcion = $("#txtDescripcion").val();
		var valor = $("#txtValor").val();
		var tiempo = $("#txtTiempo").val();
		var tiempoc = $("#txtTiempoC").val();
		var edad = $("#txtEdad").val();
		var edadMinima = $("#txtEdadMinima").val();
		var categoria = $("#selectCategoria").val();
		var subCategoria = $("#selectSubcategoria").val();
		var estado = $("input[name='radioEstado']:checked").val();
		var stock = $("#txtStock").val();
		var file = $('#fileFoto')[0].files[0]
		var foto = "";
		if(file){
		  foto = file.name;
		}
		
		//Se guardan los datos en un JSON
		var usuario = {
			nombreProducto: nombre,
			descripcion: descripcion,
			valorUnitario: valor,
			tiempo: tiempo,
			tiempoc: tiempoc,
			edad: edad,
			edadMinima: edadMinima,
			categoria: categoria,
			subcategoria: subCategoria,
			stock: stock,
			estado: estado,
			file: foto
        }		
		
		//Se envian a la funcion que realiza la conexion al werbservice y genera una respuesta que se guarda en un localstorage
		EnviarDatos(usuario, "ActionInsertarProducto.php", "CREARPRODUCTO");
		var formData = new FormData($("#formulario")[0]);
		//Subir Foto al servidor
		if(formData != null){
			SubirFoto(formData, "ActionUploadFoto.php", "SUBIRFOTO");
		}		
		//$("#selectTipoId").val();
		$("#txtNombre").val("");
		$("#txtDescripcion").val("");
		$("#txtValor").val("");
		$("#txtEdadMinima").val("");
		$("#txtEdad").val("");
		$("#txtStock").val("1");
		//$( "#rowAcudiente" ).css( "display", "none" );
		
		//Subir Foto al servidor
		//EnviarDatos(datos, "ActionUploadFoto.php", "SUBIRFOTO");
    });
	
	$("#selectCategoria").change(function(e) {
		var categoria = $("#selectCategoria").val();
		
		if($("#selectCategoria").val() != "Seleccione"){
			EnviarDatos({idCategoria: categoria}, "ActionListarSubCategorias.php", "LISTARSUBCATEGORIAS");
		}else{
			$("#selectSubcategoria").html();
		}
    });
	$("#fileFoto").change(function(e) {
        //alert($("#fileFoto").val());
		
    });
	
	$("#Salir").click(function(e) {
		localStorage.removeItem("usuario");
		localStorage.removeItem("tipoUsuario");
		window.location.href = "index.html";
	});
	window.addEventListener('load',init);
	function init(){
    	//Se envian a la funcion que realiza la conexion al werbservice y genera una respuesta que se guarda en un localstorage
		var usuarioSesion = localStorage.getItem("usuario"); 
		console.log(usuarioSesion);
		$("#usuarioSesion").html(usuarioSesion);
		EnviarDatos({}, "ActionListarCategorias.php", "LISTARCATEGORIASMODIF");	

  }
	
</script>
</body>
</html>
